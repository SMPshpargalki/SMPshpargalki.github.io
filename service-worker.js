const CACHE_NAME = "smp-shpargalki-v5";

// –í–°–ï –§–ê–ô–õ–´, –ö–û–¢–û–†–´–ï –ù–£–ñ–ù–´ –î–õ–Ø –û–§–§–õ–ê–ô–ù-–†–ê–ë–û–¢–´
const FILES_TO_CACHE = [
  "./",
  "./index.html",
  "./styles.css",
  "./manifest.json",

  // ===== –û–°–ù–û–í–ù–´–ï –°–ö–†–ò–ü–¢–´ =====
  "./—Å–∫—Ä–∏–ø—Ç—ã/script.js",
  "./—Å–∫—Ä–∏–ø—Ç—ã/theme.js",

  // ===== –ö–ê–õ–¨–ö–£–õ–Ø–¢–û–†–´ =====
  "./–ö–∞–ª—å–∫—É–ª—è—Ç–æ—Ä—ã/–ü—Ä–µ–ø–∞—Ä–∞—Ç—ã–ü–µ–¥–∏–∞—Ç—Ä–∏—è.js",
  "./–ö–∞–ª—å–∫—É–ª—è—Ç–æ—Ä—ã/–°—Ä–æ–∫–ë–µ—Ä–µ–º–µ–Ω–Ω–æ—Å—Ç–∏.js",
  "./–ö–∞–ª—å–∫—É–ª—è—Ç–æ—Ä—ã/–î–µ—Ç—Å–∫–∏–µ–ù–æ—Ä–º—ã.js",
  "./–ö–∞–ª—å–∫—É–ª—è—Ç–æ—Ä—ã/NEWS.js",
  "./–ö–∞–ª—å–∫—É–ª—è—Ç–æ—Ä—ã/–®–û–ö–°.js",
  "./–ö–∞–ª—å–∫—É–ª—è—Ç–æ—Ä—ã/–ì–õ–ê–ó–ì–û.js",
  "./–ö–∞–ª—å–∫—É–ª—è—Ç–æ—Ä—ã/–¢–≠–õ–ê.js",
  "./–ö–∞–ª—å–∫—É–ª—è—Ç–æ—Ä—ã/LAMS.js",

  // ===== –®–ê–ë–õ–û–ù–´ =====
  "./–®–∞–±–ª–æ–Ω—ã/–ê–∫—É—à–µ—Ä—Å—Ç–≤–æ.js",
  "./–®–∞–±–ª–æ–Ω—ã/–ê–Ω–µ—Å—Ç–µ–∑–∏–æ–ª–æ–≥–∏—è.js",
  "./–®–∞–±–ª–æ–Ω—ã/–ò–Ω—Ñ–µ–∫—Ü–∏—è.js",
  "./–®–∞–±–ª–æ–Ω—ã/–ö–∞—Ä–¥–∏–æ–ª–æ–≥–∏—è.js",
  "./–®–∞–±–ª–æ–Ω—ã/–ö–æ–Ω—Å—Ç–∞—Ç–∞—Ü–∏—è.js",
  "./–®–∞–±–ª–æ–Ω—ã/–ù–µ–≤—Ä–æ–ª–æ–≥–∏—è.js",
  "./–®–∞–±–ª–æ–Ω—ã/–û—Ç–æ—Ä–∏–Ω–æ–ª–∞—Ä–∏–Ω–≥–æ–ª–æ–≥–∏—è.js",
  "./–®–∞–±–ª–æ–Ω—ã/–û—Ñ—Ç–∞–ª—å–º–æ–ª–æ–≥–∏—è.js",
  "./–®–∞–±–ª–æ–Ω—ã/–ü–µ–¥–∏–∞—Ç—Ä–∏—è.js",
  "./–®–∞–±–ª–æ–Ω—ã/–°—Ç–æ–º–∞—Ç–æ–ª–æ–≥–∏—è.js",
  "./–®–∞–±–ª–æ–Ω—ã/–¢–µ—Ä–∞–ø–∏—è.js",
  "./–®–∞–±–ª–æ–Ω—ã/–¢–æ–∫—Å–∏–∫–æ–ª–æ–≥–∏—è.js",
  "./–®–∞–±–ª–æ–Ω—ã/–¢—Ä–∞–≤–º–∞—Ç–æ–ª–æ–≥–∏—è.js",
  "./–®–∞–±–ª–æ–Ω—ã/–£—Ä–æ–ª–æ–≥–∏—è.js",
  "./–®–∞–±–ª–æ–Ω—ã/–•–∏—Ä—É—Ä–≥–∏—è.js",
  "./–®–∞–±–ª–æ–Ω—ã/–ü—Ä–æ—á–µ–µ.js",
 
  // ===== –ö–ê–†–¢–ò–ù–ö–ò =====
  "./–∫–∞—Ä—Ç–∏–Ω–∫–∏/logo.png",
  "./–∫–∞—Ä—Ç–∏–Ω–∫–∏/–ë–∞–Ω–Ω–µ—Ä–î–æ–±—Ä–æ–ü–æ–∂–∞–ª–æ–≤–∞—Ç—å.jpg",
  "./–∫–∞—Ä—Ç–∏–Ω–∫–∏/–î–∏–∞–∑–µ–ø–∞–º.jpg",
  "./–∫–∞—Ä—Ç–∏–Ω–∫–∏/–ö–µ—Ç–∞–º–∏–Ω.jpg",
  "./–∫–∞—Ä—Ç–∏–Ω–∫–∏/–ú–æ—Ä—Ñ–∏–Ω.jpg",
  "./–∫–∞—Ä—Ç–∏–Ω–∫–∏/–§–µ–Ω—Ç–∞–Ω–∏–ª.jpg",
  "./–∫–∞—Ä—Ç–∏–Ω–∫–∏/–ë–µ—Å–ø—Ä–∏–∑–æ—Ä–Ω—ã–π.jpg"
];

// =======================
// INSTALL
// =======================
self.addEventListener("install", event => {
  event.waitUntil(
    caches.open(CACHE_NAME).then(cache => {
      console.log("üì¶ –ö–µ—à–∏—Ä–æ–≤–∞–Ω–∏–µ —Ñ–∞–π–ª–æ–≤");
      return cache.addAll(FILES_TO_CACHE);
    })
  );
  self.skipWaiting();
});

// =======================
// ACTIVATE
// =======================
self.addEventListener("activate", event => {
  event.waitUntil(
    caches.keys().then(keys =>
      Promise.all(
        keys.map(key => {
          if (key !== CACHE_NAME) {
            console.log("üóë –£–¥–∞–ª—ë–Ω —Å—Ç–∞—Ä—ã–π –∫–µ—à:", key);
            return caches.delete(key);
          }
        })
      )
    )
  );
  self.clients.claim();
});

// =======================
// FETCH (offline-first)
// =======================
self.addEventListener("fetch", event => {
  event.respondWith(
    caches.match(event.request).then(cached => {
      if (cached) return cached;

      return fetch(event.request)
        .then(response => {
          return caches.open(CACHE_NAME).then(cache => {
            cache.put(event.request, response.clone());
            return response;
          });
        })
        .catch(() => {
          // –µ—Å–ª–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –æ—Ñ—Ñ–ª–∞–π–Ω –∏ —ç—Ç–æ –Ω–∞–≤–∏–≥–∞—Ü–∏—è
          if (event.request.mode === "navigate") {
            return caches.match("./index.html");
          }
        });
    })
  );
});
